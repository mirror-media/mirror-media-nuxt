<template>
  <div
    v-if="!IS_AD_DISABLE"
    :id="`compass-fit-${unitId}`"
    class="micro-ad"
    :class="{ 'micro-ad--premium': isPremiumMember }"
  ></div>
</template>

<script>
import { IS_AD_DISABLE } from '~/configs/config.js'

export default {
  name: 'MicroAd',
  props: {
    unitId: {
      type: String,
      required: true,
    },
  },

  data() {
    return {
      IS_AD_DISABLE,
    }
  },
  computed: {
    isPremiumMember() {
      return this.$store?.getters?.['membership-subscribe/isPremiumMember']
    },
  },
  mounted() {
    this.insertScript()
  },
  beforeDestroy() {
    this.removeScript()
  },
  methods: {
    insertScript() {
      const microAdScript = document.createElement('script')
      microAdScript.id = `compass-fit-script-${this.unitId}`
      microAdScript.type = 'text/javascript'
      microAdScript.charset = 'UTF-8'
      microAdScript.async = true
      microAdScript.src =
        (document.location.protocol === 'https:' ? 'https://' : 'http://') +
        `nt.compass-fit.jp/lift_widget.js?adspot_id=${this.unitId}`
      document.head.appendChild(microAdScript)
    },
    removeScript() {
      const microAdScript = document.querySelector(
        `#compass-fit-script-${this.unitId}`
      )
      microAdScript?.remove()

      const autoGeneratedScript = document.querySelector(
        `script[src*="${this.unitId}"`
      )
      autoGeneratedScript?.remove()

      const microAdStyle = [
        ...document.querySelectorAll('style'),
      ].find((item) => item.textContent.includes(`#compass-fit-${this.unitId}`))
      microAdStyle?.remove()
    },
  },
}
</script>

<style lang="scss" scoped>
/**
 * 不該在此處寫上任何特定樣式
 * 若某類樣式需要在多處地方共用，可把它寫在 ~/css/micro-ad/ 資料夾中，再導進需要它的元件內
 */
</style>
